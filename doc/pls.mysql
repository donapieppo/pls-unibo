CREATE TABLE `users` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(255) DEFAULT NULL,
  `surname` varchar(255) DEFAULT NULL,
  `email` varchar(255) DEFAULT NULL,
  `contact_email` varchar(255) DEFAULT NULL,
  `description` text DEFAULT NULL,
  `telephone` varchar(255)  DEFAULT NULL,
  `updated_at` datetime DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

INSERT INTO `users` VALUES
  (1, 'Pietro', 'Donatini', 'pietro.donatini@unibo.it', NULL, NULL, NULL, NULL); 

CREATE TABLE `areas` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(255) DEFAULT NULL,
  `payoff` text DEFAULT NULL,
  `description` text DEFAULT NULL,
  `notice` text DEFAULT NULL,
  `in_charge` int(10) unsigned, -- responsabile del settore, i.e. un prof unibo.
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

INSERT INTO `areas` VALUES
  (1, "Biologia e Biotecnologie", NULL, NULL, NULL, NULL),
  (2, "Chimica", NULL, NULL, NULL, NULL),
  (3, "Fisica", NULL, NULL, NULL, NULL),
  (4, "Geologia", NULL, NULL, NULL, NULL),
  (5, "Informatica", NULL, NULL, NULL, NULL),
  (6, "Matematica", NULL, NULL, NULL, NULL),
  (7, "Scienze Naturali e Ambientali", NULL, NULL, NULL, NULL),
  (8, "Statistica", NULL, NULL, NULL, NULL);

CREATE TABLE `contacts`(
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `user_id` int(10) unsigned DEFAULT NULL,
  `name` varchar(255) DEFAULT NULL,
  `description` text DEFAULT NULL,
  `email` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`id`)
);

INSERT INTO `contacts` VALUES 
  (1, NULL, 'PLS matematica', NULL, 'mat-pls@unibo.it'),
  (2, NULL,' PLS fisica', NULL, 'difa.pls@unibo.it');

CREATE TABLE `areas_contacts` (
  `area_id` int(10) unsigned NOT NULL,
  `contact_id` int(10) unsigned NOT NULL
);

INSERT INTO `areas_contacts` VALUES
  (6,1),
  (3,2);

CREATE TABLE `audiences` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(255) DEFAULT NULL,
  `description` text DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

INSERT INTO `audiences` VALUES 
  (1, "student", NULL),
  (2, "teacher", NULL),
  (3, "unistudent", NULL),
  (4, "all", NULL);

CREATE TABLE `activity_types` ( -- categories or classifications
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(255) DEFAULT NULL,
  `description` text DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

INSERT INTO `activity_types` VALUES
  (1, "laboratorio / corso", NULL),
  (2, "laboratorio tradizionale", NULL),
  (3, "laboratorio intensivo", NULL),
  (4, "laboratorio per classi", NULL),
  (5, "laboratorio PCTO per piccolo gruppi", NULL),
  (6, "corso di formazione per insegnanti", NULL),
  (7, "seminario / ciclo di seminari", NULL),
  (8, "divulgazione", NULL),
  (9, "altro", NULL);

CREATE TABLE `activities` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(255) DEFAULT NULL,
  `description` text DEFAULT NULL,
  `activity_type_id` int(10) unsigned,
  `audience_id` int(10) unsigned,
  `global` bool DEFAULT NULL, -- vlr
  PRIMARY KEY (`id`)
);

INSERT INTO `activities` VALUES
  (1, "Metodi matematici per l'animazione", NULL, 3, 1, NULL);

CREATE TABLE `activities_areas` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `activity_id` int(10) unsigned NOT NULL,
  `area_id` int(10) unsigned NOT NULL,
  PRIMARY KEY (`id`)
);

-- CREATE TABLE `activities_contacts` ();

CREATE TABLE `editions` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `activity_id` int(10) unsigned,
  `name` varchar(255) DEFAULT NULL,
  `description` text DEFAULT NULL,
  `academic_year` smallint unsigned,
  `audience_id` int(10) unsigned,
  `global` bool DEFAULT NULL, -- vlr
  PRIMARY KEY (`id`)
);

INSERT INTO `editions` VALUES
  (1, 1, "MMA on-line", NULL, 2020, 1, NULL),
  (2, 1, "MMA Math Students", NULL, 2020, 1, NULL);
  

CREATE TABLE `areas_editions` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `area_id` int(10) unsigned NOT NULL,
  `edition_id` int(10) unsigned NOT NULL,
  `role` ENUM('organizer', 'interest'),
  PRIMARY KEY (`id`)
);

--CREATE TABLE `contacts_editions` ();

CREATE TABLE `events` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `edition_id` int(10) unsigned,
  `name` varchar(255) DEFAULT NULL,
  `description` text DEFAULT NULL,
  `audience_id` int(10) unsigned,
  `start` timestamp ,
  `end` timestamp, -- or duration
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

--CREATE TABLE `areas_events` ();

--CREATE TABLE `contacts_events` ();

-- da fare
-- attachments 
-- registrations
-- areas_of_interest

-- link "esterni" tipo progetti di fisica

-- novita`
CREATE TABLE `products` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(255) DEFAULT NULL,
  `description` text DEFAULT NULL,
  `global` bool DEFAULT NULL, -- vlr
  PRIMARY KEY (`id`)
);

INSERT INTO `products` VALUES
  (1,'Alla scoperta della flora urbana di Bologna', "documentario realizzato nell'ambito di attività PLS", NULL);
  -- ha uno o piu` attachments o video
  
-- CREATE TABLE `areas_products` ();

-- CREATE TABLE `attachments_products` ();

CREATE TABLE `videos` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(255) DEFAULT NULL,
  `url` varchar(255) DEFAULT NULL,
);

<<<<<<< HEAD

DROP table `contact_records`;

CREATE TABLE `contact_records` (
  `id` int(11) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(255),
  `record_type` varchar(255) NOT NULL, -- Activity Edition Event 
  `record_id` int(10) unsigned NOT NULL,
  `contact_id` int(10) unsigned NOT NULL,
  `created_at` datetime NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `index_contacts_records_uniqueness` (`record_type`,`record_id`, `contact_id`),
  CONSTRAINT `fk_contacts_records_contact_id` FOREIGN KEY (`contact_id`) REFERENCES `contacts` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

alter table areas drop in_charge ;
ALTER table areas add column head_id int(10) unsigned;
ALTER table areas add CONSTRAINT `fk_area_head` FOREIGN KEY (`head_id`) REFERENCES `contacts` (`id`);

CREATE TABLE `organizations` (
  `id` int(11) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(255),
  `slug` varchar(255),
  `url`  varchar(255),
  PRIMARY KEY (`id`)
);

CREATE TABLE `areas_organizations` (
  `area_id` int(11) unsigned NOT NULL,
  `organization_id` int(11) unsigned NOT NULL,
  CONSTRAINT `fk_area_org_area_id` FOREIGN KEY (`area_id`) REFERENCES `areas` (`id`),
  CONSTRAINT `fk_area_org_organization_id` FOREIGN KEY (`organization_id`) REFERENCES `organizations` (`id`)
);

INSERT INTO organizations VALUES (1, 'Dipartimento di Chimica "Giacomo Ciamician"', 'CHIM', 'https://www.chimica.unibo.it/');
INSERT INTO organizations VALUES (2, 'Dipartimento di Chimica industriale "Toso Montanari"', 'CHIMIND', 'https://www.chimica-industriale.unibo.it/');
INSERT INTO organizations VALUES (3, 'Dipartimento di Farmacia e Biotecnologie', 'FABIT', 'https://www.fabit.unibo.it/');
INSERT INTO organizations VALUES (4, 'Dipartimento di Fisica e Astronomia', 'DIFA', 'https://www.fisica-astronomia.unibo.it/');
INSERT INTO organizations VALUES (5, 'Dipartimento di Informatica – Scienza e Ingegneria', 'DISI', 'https://disi.unibo.it/it');
INSERT INTO organizations VALUES (6, 'Dipartimento di Matematica', 'MAT', 'https://www.matematica.unibo.it/');
INSERT INTO organizations VALUES (7, 'Dipartimento di Scienze Biologiche, Geologiche e Ambientali', 'BIGEA', 'https://www.bigea.unibo.it/');
INSERT INTO organizations VALUES (8, 'Dipartimento di Scienze Statistiche "Paolo Fortunati"', 'STAT', 'https://www.stat.unibo.it/');

CREATE table `area_activity_type_text` (
  `id` int(11) unsigned NOT NULL AUTO_INCREMENT,
  `area_id` int(11) unsigned NOT NULL,
  `activity_type_id` int(11) unsigned NOT NULL,
  `name` text,
  CONSTRAINT `fk_area_act_text_area_id` FOREIGN KEY (`area_id`) REFERENCES `areas` (`id`),
  CONSTRAINT `fk_area_act_text_activity_type_id` FOREIGN KEY (`activity_type_id`) REFERENCES `activity_types` (`id`)
);



CREATE TABLE `area_interests` (
  `id` int(11) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(255),
  `record_type` varchar(255) NOT NULL, -- Activity Edition Event
  `record_id` int(10) unsigned NOT NULL,
  `contact_id` int(10) unsigned NOT NULL,
  `created_at` datetime NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `index_contacts_records_uniqueness` (`record_type`,`record_id`, `contact_id`),
  CONSTRAINT `fk_contacts_records_contact_id` FOREIGN KEY (`contact_id`) REFERENCES `contacts` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;


